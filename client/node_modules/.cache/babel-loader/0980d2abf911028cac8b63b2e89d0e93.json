{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.editing_form_based.js)\r\n * Version: 21.1.5\r\n * Build date: Mon Aug 02 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport { getWindow } from \"../../core/utils/window\";\nimport eventsEngine from \"../../events/core/events_engine\";\nimport Guid from \"../../core/guid\";\nimport { isDefined, isString } from \"../../core/utils/type\";\nimport { each } from \"../../core/utils/iterator\";\nimport { extend } from \"../../core/utils/extend\";\nimport Button from \"../button\";\nimport devices from \"../../core/devices\";\nimport Form from \"../form\";\nimport { Deferred } from \"../../core/utils/deferred\";\nimport Scrollable from \"../scroll_view/ui.scrollable\";\nimport Popup from \"../popup\";\nimport { EDIT_MODE_FORM, EDIT_MODE_POPUP, FOCUSABLE_ELEMENT_SELECTOR, EDITING_EDITROWKEY_OPTION_NAME, EDITING_POPUP_OPTION_NAME, DATA_EDIT_DATA_INSERT_TYPE } from \"./ui.grid_core.editing_constants\";\nvar EDIT_FORM_ITEM_CLASS = \"edit-form-item\";\nvar EDIT_POPUP_CLASS = \"edit-popup\";\nvar SCROLLABLE_CONTAINER_CLASS = \"dx-scrollable-container\";\nvar BUTTON_CLASS = \"dx-button\";\nvar FORM_BUTTONS_CONTAINER_CLASS = \"form-buttons-container\";\n\nvar getEditorType = item => {\n  var _column$formItem;\n\n  var column = item.column;\n  return item.isCustomEditorType ? item.editorType : null === (_column$formItem = column.formItem) || void 0 === _column$formItem ? void 0 : _column$formItem.editorType;\n};\n\nvar forEachFormItems = (items, callBack) => {\n  items.forEach(item => {\n    if (item.items || item.tabs) {\n      forEachFormItems(item.items || item.tabs, callBack);\n    } else {\n      callBack(item);\n    }\n  });\n};\n\nexport var editingFormBasedModule = {\n  extenders: {\n    controllers: {\n      editing: {\n        init: function () {\n          this._editForm = null;\n          this._updateEditFormDeferred = null;\n          this.callBase.apply(this, arguments);\n        },\n        isFormOrPopupEditMode: function () {\n          return this.isPopupEditMode() || this.isFormEditMode();\n        },\n        isPopupEditMode: function () {\n          var editMode = this.option(\"editing.mode\");\n          return editMode === EDIT_MODE_POPUP;\n        },\n        isFormEditMode: function () {\n          var editMode = this.option(\"editing.mode\");\n          return editMode === EDIT_MODE_FORM;\n        },\n        getFirstEditableColumnIndex: function () {\n          var firstFormItem = this._firstFormItem;\n\n          if (this.isFormEditMode() && firstFormItem) {\n            var editRowKey = this.option(EDITING_EDITROWKEY_OPTION_NAME);\n\n            var editRowIndex = this._dataController.getRowIndexByKey(editRowKey);\n\n            var $editFormElements = this._rowsView.getCellElements(editRowIndex);\n\n            return this._rowsView._getEditFormEditorVisibleIndex($editFormElements, firstFormItem.column);\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        getEditFormRowIndex: function () {\n          return this.isFormOrPopupEditMode() ? this._getVisibleEditRowIndex() : this.callBase.apply(this, arguments);\n        },\n        _isEditColumnVisible: function () {\n          var result = this.callBase.apply(this, arguments);\n          var editingOptions = this.option(\"editing\");\n          return this.isFormOrPopupEditMode() ? editingOptions.allowUpdating || result : result;\n        },\n        _handleDataChanged: function (args) {\n          var editForm = this._editForm;\n\n          if (\"refresh\" === args.changeType && this.isPopupEditMode() && null !== editForm && void 0 !== editForm && editForm.option(\"visible\")) {\n            this._repaintEditPopup();\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        getPopupContent: function () {\n          var _this$_editPopup;\n\n          var popupVisible = null === (_this$_editPopup = this._editPopup) || void 0 === _this$_editPopup ? void 0 : _this$_editPopup.option(\"visible\");\n\n          if (this.isPopupEditMode() && popupVisible) {\n            return this._$popupContent;\n          }\n        },\n        _showAddedRow: function (rowIndex) {\n          if (this.isPopupEditMode()) {\n            this._showEditPopup(rowIndex);\n          } else {\n            this.callBase.apply(this, arguments);\n          }\n        },\n        _cancelEditDataCore: function () {\n          this.callBase.apply(this, arguments);\n\n          if (this.isPopupEditMode()) {\n            this._hideEditPopup();\n          }\n        },\n        _updateEditRowCore: function (row, skipCurrentRow, isCustomSetCellValue) {\n          var editForm = this._editForm;\n\n          if (this.isPopupEditMode()) {\n            if (this.option(\"repaintChangesOnly\")) {\n              var _row$update;\n\n              null === (_row$update = row.update) || void 0 === _row$update ? void 0 : _row$update.call(row, row);\n            } else if (editForm) {\n              this._updateEditFormDeferred = new Deferred().done(() => editForm.repaint());\n\n              if (!this._updateLockCount) {\n                this._updateEditFormDeferred.resolve();\n              }\n            }\n          } else {\n            this.callBase.apply(this, arguments);\n          }\n        },\n        _showEditPopup: function (rowIndex, repaintForm) {\n          var isMobileDevice = \"desktop\" !== devices.current().deviceType;\n          var popupOptions = extend({\n            showTitle: false,\n            fullScreen: isMobileDevice,\n            toolbarItems: [{\n              toolbar: \"bottom\",\n              location: \"after\",\n              widget: \"dxButton\",\n              options: this._getSaveButtonConfig()\n            }, {\n              toolbar: \"bottom\",\n              location: \"after\",\n              widget: \"dxButton\",\n              options: this._getCancelButtonConfig()\n            }],\n            contentTemplate: this._getPopupEditFormTemplate(rowIndex)\n          }, this.option(EDITING_POPUP_OPTION_NAME));\n\n          if (!this._editPopup) {\n            var $popupContainer = $(\"<div>\").appendTo(this.component.$element()).addClass(this.addWidgetPrefix(EDIT_POPUP_CLASS));\n            this._editPopup = this._createComponent($popupContainer, Popup, {});\n\n            this._editPopup.on(\"hiding\", this._getEditPopupHiddenHandler());\n\n            this._editPopup.on(\"shown\", e => {\n              eventsEngine.trigger(e.component.$content().find(FOCUSABLE_ELEMENT_SELECTOR).not(\".\" + SCROLLABLE_CONTAINER_CLASS).first(), \"focus\");\n\n              if (repaintForm) {\n                var _this$_editForm;\n\n                null === (_this$_editForm = this._editForm) || void 0 === _this$_editForm ? void 0 : _this$_editForm.repaint();\n              }\n            });\n          }\n\n          this._editPopup.option(popupOptions);\n\n          this._editPopup.show();\n\n          this.callBase.apply(this, arguments);\n        },\n        _getPopupEditFormTemplate: function (rowIndex) {\n          var row = this.component.getVisibleRows()[rowIndex];\n          var templateOptions = {\n            row: row,\n            rowType: row.rowType,\n            key: row.key\n          };\n          return container => {\n            var formTemplate = this.getEditFormTemplate();\n\n            var scrollable = this._createComponent($(\"<div>\").appendTo(container), Scrollable);\n\n            this._$popupContent = scrollable.$content();\n            formTemplate(this._$popupContent, templateOptions, true);\n          };\n        },\n        _repaintEditPopup: function () {\n          var _this$_editPopup2;\n\n          var rowIndex = this._getVisibleEditRowIndex();\n\n          if (null !== (_this$_editPopup2 = this._editPopup) && void 0 !== _this$_editPopup2 && _this$_editPopup2.option(\"visible\") && rowIndex >= 0) {\n            var defaultAnimation = this._editPopup.option(\"animation\");\n\n            this._editPopup.option(\"animation\", null);\n\n            this._showEditPopup(rowIndex, true);\n\n            this._editPopup.option(\"animation\", defaultAnimation);\n          }\n        },\n        _hideEditPopup: function () {\n          var _this$_editPopup3;\n\n          null === (_this$_editPopup3 = this._editPopup) || void 0 === _this$_editPopup3 ? void 0 : _this$_editPopup3.option(\"visible\", false);\n        },\n        optionChanged: function (args) {\n          if (\"editing\" === args.name && this.isFormOrPopupEditMode()) {\n            var fullName = args.fullName;\n            var editPopup = this._editPopup;\n\n            if (0 === (null === fullName || void 0 === fullName ? void 0 : fullName.indexOf(EDITING_POPUP_OPTION_NAME))) {\n              if (editPopup) {\n                var popupOptionName = fullName.slice(EDITING_POPUP_OPTION_NAME.length + 1);\n\n                if (popupOptionName) {\n                  editPopup.option(popupOptionName, args.value);\n                } else {\n                  editPopup.option(args.value);\n                }\n              }\n\n              args.handled = true;\n            } else if (null !== editPopup && void 0 !== editPopup && editPopup.option(\"visible\") && 0 === fullName.indexOf(\"editing.form\")) {\n              this._repaintEditPopup();\n\n              args.handled = true;\n            }\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        renderFormEditTemplate: function (detailCellOptions, item, form, container, isReadOnly) {\n          var that = this;\n          var $container = $(container);\n          var column = item.column;\n          var editorType = getEditorType(item);\n          var rowData = null === detailCellOptions || void 0 === detailCellOptions ? void 0 : detailCellOptions.row.data;\n          var cellOptions = extend({}, detailCellOptions, {\n            data: rowData,\n            cellElement: null,\n            isOnForm: true,\n            item: item,\n            column: extend({}, column, {\n              editorType: editorType,\n              editorOptions: item.editorOptions\n            }),\n            id: form.getItemID(item.name || item.dataField),\n            columnIndex: column.index,\n            setValue: !isReadOnly && column.allowEditing && function (value) {\n              that.updateFieldValue(cellOptions, value);\n            }\n          });\n          cellOptions.value = column.calculateCellValue(rowData);\n\n          var template = this._getFormEditItemTemplate.bind(this)(cellOptions, column);\n\n          this._rowsView.renderTemplate($container, template, cellOptions, !!$container.closest(getWindow().document).length).done(() => {\n            this._rowsView._updateCell($container, cellOptions);\n          });\n\n          return cellOptions;\n        },\n        getFormEditorTemplate: function (cellOptions, item) {\n          var column = this.component.columnOption(item.dataField);\n          return (options, container) => {\n            var _cellOptions$row$watc, _cellOptions$row;\n\n            var $container = $(container);\n            null === (_cellOptions$row$watc = (_cellOptions$row = cellOptions.row).watch) || void 0 === _cellOptions$row$watc ? void 0 : _cellOptions$row$watc.call(_cellOptions$row, function () {\n              return column.selector(cellOptions.row.data);\n            }, () => {\n              var _validator;\n\n              var $editorElement = $container.find(\".dx-widget\").first();\n              var validator = $editorElement.data(\"dxValidator\");\n              var validatorOptions = null === (_validator = validator) || void 0 === _validator ? void 0 : _validator.option();\n              $container.contents().remove();\n              cellOptions = this.renderFormEditTemplate.bind(this)(cellOptions, item, options.component, $container);\n              $editorElement = $container.find(\".dx-widget\").first();\n              validator = $editorElement.data(\"dxValidator\");\n\n              if (validatorOptions && !validator) {\n                $editorElement.dxValidator({\n                  validationRules: validatorOptions.validationRules,\n                  validationGroup: validatorOptions.validationGroup,\n                  dataGetter: validatorOptions.dataGetter\n                });\n              }\n            });\n            cellOptions = this.renderFormEditTemplate.bind(this)(cellOptions, item, options.component, $container);\n          };\n        },\n        getEditFormOptions: function (detailOptions) {\n          var _this$_getValidationG;\n\n          var editFormOptions = null === (_this$_getValidationG = this._getValidationGroupsInForm) || void 0 === _this$_getValidationG ? void 0 : _this$_getValidationG.call(this, detailOptions);\n          var userCustomizeItem = this.option(\"editing.form.customizeItem\");\n          var editFormItemClass = this.addWidgetPrefix(EDIT_FORM_ITEM_CLASS);\n          var items = this.option(\"editing.form.items\");\n          var isCustomEditorType = {};\n\n          if (!items) {\n            var columns = this.getController(\"columns\").getColumns();\n            items = [];\n            each(columns, function (_, column) {\n              if (!column.isBand && !column.type) {\n                items.push({\n                  column: column,\n                  name: column.name,\n                  dataField: column.dataField\n                });\n              }\n            });\n          } else {\n            forEachFormItems(items, item => {\n              var itemId = (null === item || void 0 === item ? void 0 : item.name) || (null === item || void 0 === item ? void 0 : item.dataField);\n\n              if (itemId) {\n                isCustomEditorType[itemId] = !!item.editorType;\n              }\n            });\n          }\n\n          return extend({}, editFormOptions, {\n            items: items,\n            formID: \"dx-\" + new Guid(),\n            customizeItem: item => {\n              var column;\n              var itemId = item.name || item.dataField;\n\n              if (item.column || itemId) {\n                column = item.column || this._columnsController.columnOption(item.name ? \"name:\" + item.name : \"dataField:\" + item.dataField);\n              }\n\n              if (column) {\n                item.label = item.label || {};\n                item.label.text = item.label.text || column.caption;\n                item.template = item.template || this.getFormEditorTemplate(detailOptions, item);\n                item.column = column;\n                item.isCustomEditorType = isCustomEditorType[itemId];\n\n                if (column.formItem) {\n                  extend(item, column.formItem);\n                }\n\n                if (void 0 === item.isRequired && column.validationRules) {\n                  item.isRequired = column.validationRules.some(function (rule) {\n                    return \"required\" === rule.type;\n                  });\n                  item.validationRules = [];\n                }\n\n                var itemVisible = isDefined(item.visible) ? item.visible : true;\n\n                if (!this._firstFormItem && itemVisible) {\n                  this._firstFormItem = item;\n                }\n              }\n\n              null === userCustomizeItem || void 0 === userCustomizeItem ? void 0 : userCustomizeItem.call(this, item);\n              item.cssClass = isString(item.cssClass) ? item.cssClass + \" \" + editFormItemClass : editFormItemClass;\n            }\n          });\n        },\n        getEditFormTemplate: function () {\n          return ($container, detailOptions, renderFormOnly) => {\n            var editFormOptions = this.option(\"editing.form\");\n            var baseEditFormOptions = this.getEditFormOptions(detailOptions);\n            this._firstFormItem = void 0;\n            this._editForm = this._createComponent($(\"<div>\").appendTo($container), Form, extend({}, editFormOptions, baseEditFormOptions));\n\n            if (!renderFormOnly) {\n              var $buttonsContainer = $(\"<div>\").addClass(this.addWidgetPrefix(FORM_BUTTONS_CONTAINER_CLASS)).appendTo($container);\n\n              this._createComponent($(\"<div>\").appendTo($buttonsContainer), Button, this._getSaveButtonConfig());\n\n              this._createComponent($(\"<div>\").appendTo($buttonsContainer), Button, this._getCancelButtonConfig());\n            }\n\n            this._editForm.on(\"contentReady\", () => {\n              var _this$_editPopup4;\n\n              null === (_this$_editPopup4 = this._editPopup) || void 0 === _this$_editPopup4 ? void 0 : _this$_editPopup4.repaint();\n            });\n          };\n        },\n        getEditForm: function () {\n          return this._editForm;\n        },\n        _endUpdateCore: function () {\n          var _this$_updateEditForm;\n\n          null === (_this$_updateEditForm = this._updateEditFormDeferred) || void 0 === _this$_updateEditForm ? void 0 : _this$_updateEditForm.resolve();\n        },\n        _beforeEndSaving: function () {\n          this.callBase.apply(this, arguments);\n\n          if (this.isPopupEditMode()) {\n            var _this$_editPopup5;\n\n            null === (_this$_editPopup5 = this._editPopup) || void 0 === _this$_editPopup5 ? void 0 : _this$_editPopup5.hide();\n          }\n        },\n        _processDataItemCore: function (item, _ref) {\n          var {\n            type: type\n          } = _ref;\n\n          if (this.isPopupEditMode() && type === DATA_EDIT_DATA_INSERT_TYPE) {\n            item.visible = false;\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        _editRowFromOptionChangedCore: function (rowIndices, rowIndex, oldRowIndex) {\n          if (this.isPopupEditMode()) {\n            this._showEditPopup(rowIndex);\n          } else {\n            this.callBase.apply(this, arguments);\n          }\n        }\n      },\n      data: {\n        _updateEditItem: function (item) {\n          if (this._editingController.isFormEditMode()) {\n            item.rowType = \"detail\";\n          }\n        }\n      }\n    },\n    views: {\n      rowsView: {\n        _renderCellContent: function ($cell, options) {\n          if (\"data\" === options.rowType && this._editingController.isPopupEditMode() && false === options.row.visible) {\n            return;\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        getCellElements: function (rowIndex) {\n          var $cellElements = this.callBase(rowIndex);\n          var editingController = this._editingController;\n          var editForm = editingController.getEditForm();\n          var editFormRowIndex = editingController.getEditFormRowIndex();\n\n          if (editFormRowIndex === rowIndex && $cellElements && editForm) {\n            return editForm.$element().find(\".\" + this.addWidgetPrefix(EDIT_FORM_ITEM_CLASS) + \", .\" + BUTTON_CLASS);\n          }\n\n          return $cellElements;\n        },\n        _getVisibleColumnIndex: function ($cells, rowIndex, columnIdentifier) {\n          var editFormRowIndex = this._editingController.getEditFormRowIndex();\n\n          if (editFormRowIndex === rowIndex && isString(columnIdentifier)) {\n            var column = this._columnsController.columnOption(columnIdentifier);\n\n            return this._getEditFormEditorVisibleIndex($cells, column);\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _getEditFormEditorVisibleIndex: function ($cells, column) {\n          var visibleIndex = -1;\n          each($cells, function (index, cellElement) {\n            var item = $(cellElement).find(\".dx-field-item-content\").data(\"dx-form-item\");\n\n            if (null !== item && void 0 !== item && item.column && column && item.column.index === column.index) {\n              visibleIndex = index;\n              return false;\n            }\n          });\n          return visibleIndex;\n        },\n        _isFormItem: function (parameters) {\n          var isDetailRow = \"detail\" === parameters.rowType || \"detailAdaptive\" === parameters.rowType;\n\n          var isPopupEditing = \"data\" === parameters.rowType && this._editingController.isPopupEditMode();\n\n          return (isDetailRow || isPopupEditing) && parameters.item;\n        },\n        _updateCell: function ($cell, parameters) {\n          if (this._isFormItem(parameters)) {\n            this._formItemPrepared(parameters, $cell);\n          } else {\n            this.callBase($cell, parameters);\n          }\n        }\n      }\n    }\n  }\n};","map":{"version":3,"sources":["/home/mukulsharma/Desktop/CyAmast/PortIntel/dashApp/node_modules/devextreme/esm/ui/grid_core/ui.grid_core.editing_form_based.js"],"names":["$","getWindow","eventsEngine","Guid","isDefined","isString","each","extend","Button","devices","Form","Deferred","Scrollable","Popup","EDIT_MODE_FORM","EDIT_MODE_POPUP","FOCUSABLE_ELEMENT_SELECTOR","EDITING_EDITROWKEY_OPTION_NAME","EDITING_POPUP_OPTION_NAME","DATA_EDIT_DATA_INSERT_TYPE","EDIT_FORM_ITEM_CLASS","EDIT_POPUP_CLASS","SCROLLABLE_CONTAINER_CLASS","BUTTON_CLASS","FORM_BUTTONS_CONTAINER_CLASS","getEditorType","item","_column$formItem","column","isCustomEditorType","editorType","formItem","forEachFormItems","items","callBack","forEach","tabs","editingFormBasedModule","extenders","controllers","editing","init","_editForm","_updateEditFormDeferred","callBase","apply","arguments","isFormOrPopupEditMode","isPopupEditMode","isFormEditMode","editMode","option","getFirstEditableColumnIndex","firstFormItem","_firstFormItem","editRowKey","editRowIndex","_dataController","getRowIndexByKey","$editFormElements","_rowsView","getCellElements","_getEditFormEditorVisibleIndex","getEditFormRowIndex","_getVisibleEditRowIndex","_isEditColumnVisible","result","editingOptions","allowUpdating","_handleDataChanged","args","editForm","changeType","_repaintEditPopup","getPopupContent","_this$_editPopup","popupVisible","_editPopup","_$popupContent","_showAddedRow","rowIndex","_showEditPopup","_cancelEditDataCore","_hideEditPopup","_updateEditRowCore","row","skipCurrentRow","isCustomSetCellValue","_row$update","update","call","done","repaint","_updateLockCount","resolve","repaintForm","isMobileDevice","current","deviceType","popupOptions","showTitle","fullScreen","toolbarItems","toolbar","location","widget","options","_getSaveButtonConfig","_getCancelButtonConfig","contentTemplate","_getPopupEditFormTemplate","$popupContainer","appendTo","component","$element","addClass","addWidgetPrefix","_createComponent","on","_getEditPopupHiddenHandler","e","trigger","$content","find","not","first","_this$_editForm","show","getVisibleRows","templateOptions","rowType","key","container","formTemplate","getEditFormTemplate","scrollable","_this$_editPopup2","defaultAnimation","_this$_editPopup3","optionChanged","name","fullName","editPopup","indexOf","popupOptionName","slice","length","value","handled","renderFormEditTemplate","detailCellOptions","form","isReadOnly","that","$container","rowData","data","cellOptions","cellElement","isOnForm","editorOptions","id","getItemID","dataField","columnIndex","index","setValue","allowEditing","updateFieldValue","calculateCellValue","template","_getFormEditItemTemplate","bind","renderTemplate","closest","document","_updateCell","getFormEditorTemplate","columnOption","_cellOptions$row$watc","_cellOptions$row","watch","selector","_validator","$editorElement","validator","validatorOptions","contents","remove","dxValidator","validationRules","validationGroup","dataGetter","getEditFormOptions","detailOptions","_this$_getValidationG","editFormOptions","_getValidationGroupsInForm","userCustomizeItem","editFormItemClass","columns","getController","getColumns","_","isBand","type","push","itemId","formID","customizeItem","_columnsController","label","text","caption","isRequired","some","rule","itemVisible","visible","cssClass","renderFormOnly","baseEditFormOptions","$buttonsContainer","_this$_editPopup4","getEditForm","_endUpdateCore","_this$_updateEditForm","_beforeEndSaving","_this$_editPopup5","hide","_processDataItemCore","_ref","_editRowFromOptionChangedCore","rowIndices","oldRowIndex","_updateEditItem","_editingController","views","rowsView","_renderCellContent","$cell","$cellElements","editingController","editFormRowIndex","_getVisibleColumnIndex","$cells","columnIdentifier","visibleIndex","_isFormItem","parameters","isDetailRow","isPopupEditing","_formItemPrepared"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAc,qBAAd;AACA,SACIC,SADJ,QAEO,yBAFP;AAGA,OAAOC,YAAP,MAAyB,iCAAzB;AACA,OAAOC,IAAP,MAAiB,iBAAjB;AACA,SACIC,SADJ,EAEIC,QAFJ,QAGO,uBAHP;AAIA,SACIC,IADJ,QAEO,2BAFP;AAGA,SACIC,MADJ,QAEO,yBAFP;AAGA,OAAOC,MAAP,MAAmB,WAAnB;AACA,OAAOC,OAAP,MAAoB,oBAApB;AACA,OAAOC,IAAP,MAAiB,SAAjB;AACA,SACIC,QADJ,QAEO,2BAFP;AAGA,OAAOC,UAAP,MAAuB,8BAAvB;AACA,OAAOC,KAAP,MAAkB,UAAlB;AACA,SACIC,cADJ,EAEIC,eAFJ,EAGIC,0BAHJ,EAIIC,8BAJJ,EAKIC,yBALJ,EAMIC,0BANJ,QAOO,kCAPP;AAQA,IAAIC,oBAAoB,GAAG,gBAA3B;AACA,IAAIC,gBAAgB,GAAG,YAAvB;AACA,IAAIC,0BAA0B,GAAG,yBAAjC;AACA,IAAIC,YAAY,GAAG,WAAnB;AACA,IAAIC,4BAA4B,GAAG,wBAAnC;;AACA,IAAIC,aAAa,GAAGC,IAAI,IAAI;AACxB,MAAIC,gBAAJ;;AACA,MAAIC,MAAM,GAAGF,IAAI,CAACE,MAAlB;AACA,SAAOF,IAAI,CAACG,kBAAL,GAA0BH,IAAI,CAACI,UAA/B,GAA4C,UAAUH,gBAAgB,GAAGC,MAAM,CAACG,QAApC,KAAiD,KAAK,CAAL,KAAWJ,gBAA5D,GAA+E,KAAK,CAApF,GAAwFA,gBAAgB,CAACG,UAA5J;AACH,CAJD;;AAKA,IAAIE,gBAAgB,GAAG,CAACC,KAAD,EAAQC,QAAR,KAAqB;AACxCD,EAAAA,KAAK,CAACE,OAAN,CAAcT,IAAI,IAAI;AAClB,QAAIA,IAAI,CAACO,KAAL,IAAcP,IAAI,CAACU,IAAvB,EAA6B;AACzBJ,MAAAA,gBAAgB,CAACN,IAAI,CAACO,KAAL,IAAcP,IAAI,CAACU,IAApB,EAA0BF,QAA1B,CAAhB;AACH,KAFD,MAEO;AACHA,MAAAA,QAAQ,CAACR,IAAD,CAAR;AACH;AACJ,GAND;AAOH,CARD;;AASA,OAAO,IAAIW,sBAAsB,GAAG;AAChCC,EAAAA,SAAS,EAAE;AACPC,IAAAA,WAAW,EAAE;AACTC,MAAAA,OAAO,EAAE;AACLC,QAAAA,IAAI,EAAE,YAAW;AACb,eAAKC,SAAL,GAAiB,IAAjB;AACA,eAAKC,uBAAL,GAA+B,IAA/B;AACA,eAAKC,QAAL,CAAcC,KAAd,CAAoB,IAApB,EAA0BC,SAA1B;AACH,SALI;AAMLC,QAAAA,qBAAqB,EAAE,YAAW;AAC9B,iBAAO,KAAKC,eAAL,MAA0B,KAAKC,cAAL,EAAjC;AACH,SARI;AASLD,QAAAA,eAAe,EAAE,YAAW;AACxB,cAAIE,QAAQ,GAAG,KAAKC,MAAL,CAAY,cAAZ,CAAf;AACA,iBAAOD,QAAQ,KAAKnC,eAApB;AACH,SAZI;AAaLkC,QAAAA,cAAc,EAAE,YAAW;AACvB,cAAIC,QAAQ,GAAG,KAAKC,MAAL,CAAY,cAAZ,CAAf;AACA,iBAAOD,QAAQ,KAAKpC,cAApB;AACH,SAhBI;AAiBLsC,QAAAA,2BAA2B,EAAE,YAAW;AACpC,cAAIC,aAAa,GAAG,KAAKC,cAAzB;;AACA,cAAI,KAAKL,cAAL,MAAyBI,aAA7B,EAA4C;AACxC,gBAAIE,UAAU,GAAG,KAAKJ,MAAL,CAAYlC,8BAAZ,CAAjB;;AACA,gBAAIuC,YAAY,GAAG,KAAKC,eAAL,CAAqBC,gBAArB,CAAsCH,UAAtC,CAAnB;;AACA,gBAAII,iBAAiB,GAAG,KAAKC,SAAL,CAAeC,eAAf,CAA+BL,YAA/B,CAAxB;;AACA,mBAAO,KAAKI,SAAL,CAAeE,8BAAf,CAA8CH,iBAA9C,EAAiEN,aAAa,CAACzB,MAA/E,CAAP;AACH;;AACD,iBAAO,KAAKgB,QAAL,CAAcC,KAAd,CAAoB,IAApB,EAA0BC,SAA1B,CAAP;AACH,SA1BI;AA2BLiB,QAAAA,mBAAmB,EAAE,YAAW;AAC5B,iBAAO,KAAKhB,qBAAL,KAA+B,KAAKiB,uBAAL,EAA/B,GAAgE,KAAKpB,QAAL,CAAcC,KAAd,CAAoB,IAApB,EAA0BC,SAA1B,CAAvE;AACH,SA7BI;AA8BLmB,QAAAA,oBAAoB,EAAE,YAAW;AAC7B,cAAIC,MAAM,GAAG,KAAKtB,QAAL,CAAcC,KAAd,CAAoB,IAApB,EAA0BC,SAA1B,CAAb;AACA,cAAIqB,cAAc,GAAG,KAAKhB,MAAL,CAAY,SAAZ,CAArB;AACA,iBAAO,KAAKJ,qBAAL,KAA+BoB,cAAc,CAACC,aAAf,IAAgCF,MAA/D,GAAwEA,MAA/E;AACH,SAlCI;AAmCLG,QAAAA,kBAAkB,EAAE,UAASC,IAAT,EAAe;AAC/B,cAAIC,QAAQ,GAAG,KAAK7B,SAApB;;AACA,cAAI,cAAc4B,IAAI,CAACE,UAAnB,IAAiC,KAAKxB,eAAL,EAAjC,IAA2D,SAASuB,QAApE,IAAgF,KAAK,CAAL,KAAWA,QAA3F,IAAuGA,QAAQ,CAACpB,MAAT,CAAgB,SAAhB,CAA3G,EAAuI;AACnI,iBAAKsB,iBAAL;AACH;;AACD,eAAK7B,QAAL,CAAcC,KAAd,CAAoB,IAApB,EAA0BC,SAA1B;AACH,SAzCI;AA0CL4B,QAAAA,eAAe,EAAE,YAAW;AACxB,cAAIC,gBAAJ;;AACA,cAAIC,YAAY,GAAG,UAAUD,gBAAgB,GAAG,KAAKE,UAAlC,KAAiD,KAAK,CAAL,KAAWF,gBAA5D,GAA+E,KAAK,CAApF,GAAwFA,gBAAgB,CAACxB,MAAjB,CAAwB,SAAxB,CAA3G;;AACA,cAAI,KAAKH,eAAL,MAA0B4B,YAA9B,EAA4C;AACxC,mBAAO,KAAKE,cAAZ;AACH;AACJ,SAhDI;AAiDLC,QAAAA,aAAa,EAAE,UAASC,QAAT,EAAmB;AAC9B,cAAI,KAAKhC,eAAL,EAAJ,EAA4B;AACxB,iBAAKiC,cAAL,CAAoBD,QAApB;AACH,WAFD,MAEO;AACH,iBAAKpC,QAAL,CAAcC,KAAd,CAAoB,IAApB,EAA0BC,SAA1B;AACH;AACJ,SAvDI;AAwDLoC,QAAAA,mBAAmB,EAAE,YAAW;AAC5B,eAAKtC,QAAL,CAAcC,KAAd,CAAoB,IAApB,EAA0BC,SAA1B;;AACA,cAAI,KAAKE,eAAL,EAAJ,EAA4B;AACxB,iBAAKmC,cAAL;AACH;AACJ,SA7DI;AA8DLC,QAAAA,kBAAkB,EAAE,UAASC,GAAT,EAAcC,cAAd,EAA8BC,oBAA9B,EAAoD;AACpE,cAAIhB,QAAQ,GAAG,KAAK7B,SAApB;;AACA,cAAI,KAAKM,eAAL,EAAJ,EAA4B;AACxB,gBAAI,KAAKG,MAAL,CAAY,oBAAZ,CAAJ,EAAuC;AACnC,kBAAIqC,WAAJ;;AACA,wBAAUA,WAAW,GAAGH,GAAG,CAACI,MAA5B,KAAuC,KAAK,CAAL,KAAWD,WAAlD,GAAgE,KAAK,CAArE,GAAyEA,WAAW,CAACE,IAAZ,CAAiBL,GAAjB,EAAsBA,GAAtB,CAAzE;AACH,aAHD,MAGO,IAAId,QAAJ,EAAc;AACjB,mBAAK5B,uBAAL,GAAgC,IAAIhC,QAAJ,EAAD,CAAegF,IAAf,CAAoB,MAAMpB,QAAQ,CAACqB,OAAT,EAA1B,CAA/B;;AACA,kBAAI,CAAC,KAAKC,gBAAV,EAA4B;AACxB,qBAAKlD,uBAAL,CAA6BmD,OAA7B;AACH;AACJ;AACJ,WAVD,MAUO;AACH,iBAAKlD,QAAL,CAAcC,KAAd,CAAoB,IAApB,EAA0BC,SAA1B;AACH;AACJ,SA7EI;AA8ELmC,QAAAA,cAAc,EAAE,UAASD,QAAT,EAAmBe,WAAnB,EAAgC;AAC5C,cAAIC,cAAc,GAAG,cAAcvF,OAAO,CAACwF,OAAR,GAAkBC,UAArD;AACA,cAAIC,YAAY,GAAG5F,MAAM,CAAC;AACtB6F,YAAAA,SAAS,EAAE,KADW;AAEtBC,YAAAA,UAAU,EAAEL,cAFU;AAGtBM,YAAAA,YAAY,EAAE,CAAC;AACXC,cAAAA,OAAO,EAAE,QADE;AAEXC,cAAAA,QAAQ,EAAE,OAFC;AAGXC,cAAAA,MAAM,EAAE,UAHG;AAIXC,cAAAA,OAAO,EAAE,KAAKC,oBAAL;AAJE,aAAD,EAKX;AACCJ,cAAAA,OAAO,EAAE,QADV;AAECC,cAAAA,QAAQ,EAAE,OAFX;AAGCC,cAAAA,MAAM,EAAE,UAHT;AAICC,cAAAA,OAAO,EAAE,KAAKE,sBAAL;AAJV,aALW,CAHQ;AActBC,YAAAA,eAAe,EAAE,KAAKC,yBAAL,CAA+B9B,QAA/B;AAdK,WAAD,EAetB,KAAK7B,MAAL,CAAYjC,yBAAZ,CAfsB,CAAzB;;AAgBA,cAAI,CAAC,KAAK2D,UAAV,EAAsB;AAClB,gBAAIkC,eAAe,GAAG/G,CAAC,CAAC,OAAD,CAAD,CAAWgH,QAAX,CAAoB,KAAKC,SAAL,CAAeC,QAAf,EAApB,EAA+CC,QAA/C,CAAwD,KAAKC,eAAL,CAAqB/F,gBAArB,CAAxD,CAAtB;AACA,iBAAKwD,UAAL,GAAkB,KAAKwC,gBAAL,CAAsBN,eAAtB,EAAuClG,KAAvC,EAA8C,EAA9C,CAAlB;;AACA,iBAAKgE,UAAL,CAAgByC,EAAhB,CAAmB,QAAnB,EAA6B,KAAKC,0BAAL,EAA7B;;AACA,iBAAK1C,UAAL,CAAgByC,EAAhB,CAAmB,OAAnB,EAA4BE,CAAC,IAAI;AAC7BtH,cAAAA,YAAY,CAACuH,OAAb,CAAqBD,CAAC,CAACP,SAAF,CAAYS,QAAZ,GAAuBC,IAAvB,CAA4B3G,0BAA5B,EAAwD4G,GAAxD,CAA4D,MAAMtG,0BAAlE,EAA8FuG,KAA9F,EAArB,EAA4H,OAA5H;;AACA,kBAAI9B,WAAJ,EAAiB;AACb,oBAAI+B,eAAJ;;AACA,0BAAUA,eAAe,GAAG,KAAKpF,SAAjC,KAA+C,KAAK,CAAL,KAAWoF,eAA1D,GAA4E,KAAK,CAAjF,GAAqFA,eAAe,CAAClC,OAAhB,EAArF;AACH;AACJ,aAND;AAOH;;AACD,eAAKf,UAAL,CAAgB1B,MAAhB,CAAuBgD,YAAvB;;AACA,eAAKtB,UAAL,CAAgBkD,IAAhB;;AACA,eAAKnF,QAAL,CAAcC,KAAd,CAAoB,IAApB,EAA0BC,SAA1B;AACH,SA/GI;AAgHLgE,QAAAA,yBAAyB,EAAE,UAAS9B,QAAT,EAAmB;AAC1C,cAAIK,GAAG,GAAG,KAAK4B,SAAL,CAAee,cAAf,GAAgChD,QAAhC,CAAV;AACA,cAAIiD,eAAe,GAAG;AAClB5C,YAAAA,GAAG,EAAEA,GADa;AAElB6C,YAAAA,OAAO,EAAE7C,GAAG,CAAC6C,OAFK;AAGlBC,YAAAA,GAAG,EAAE9C,GAAG,CAAC8C;AAHS,WAAtB;AAKA,iBAAOC,SAAS,IAAI;AAChB,gBAAIC,YAAY,GAAG,KAAKC,mBAAL,EAAnB;;AACA,gBAAIC,UAAU,GAAG,KAAKlB,gBAAL,CAAsBrH,CAAC,CAAC,OAAD,CAAD,CAAWgH,QAAX,CAAoBoB,SAApB,CAAtB,EAAsDxH,UAAtD,CAAjB;;AACA,iBAAKkE,cAAL,GAAsByD,UAAU,CAACb,QAAX,EAAtB;AACAW,YAAAA,YAAY,CAAC,KAAKvD,cAAN,EAAsBmD,eAAtB,EAAuC,IAAvC,CAAZ;AACH,WALD;AAMH,SA7HI;AA8HLxD,QAAAA,iBAAiB,EAAE,YAAW;AAC1B,cAAI+D,iBAAJ;;AACA,cAAIxD,QAAQ,GAAG,KAAKhB,uBAAL,EAAf;;AACA,cAAI,UAAUwE,iBAAiB,GAAG,KAAK3D,UAAnC,KAAkD,KAAK,CAAL,KAAW2D,iBAA7D,IAAkFA,iBAAiB,CAACrF,MAAlB,CAAyB,SAAzB,CAAlF,IAAyH6B,QAAQ,IAAI,CAAzI,EAA4I;AACxI,gBAAIyD,gBAAgB,GAAG,KAAK5D,UAAL,CAAgB1B,MAAhB,CAAuB,WAAvB,CAAvB;;AACA,iBAAK0B,UAAL,CAAgB1B,MAAhB,CAAuB,WAAvB,EAAoC,IAApC;;AACA,iBAAK8B,cAAL,CAAoBD,QAApB,EAA8B,IAA9B;;AACA,iBAAKH,UAAL,CAAgB1B,MAAhB,CAAuB,WAAvB,EAAoCsF,gBAApC;AACH;AACJ,SAvII;AAwILtD,QAAAA,cAAc,EAAE,YAAW;AACvB,cAAIuD,iBAAJ;;AACA,oBAAUA,iBAAiB,GAAG,KAAK7D,UAAnC,KAAkD,KAAK,CAAL,KAAW6D,iBAA7D,GAAiF,KAAK,CAAtF,GAA0FA,iBAAiB,CAACvF,MAAlB,CAAyB,SAAzB,EAAoC,KAApC,CAA1F;AACH,SA3II;AA4ILwF,QAAAA,aAAa,EAAE,UAASrE,IAAT,EAAe;AAC1B,cAAI,cAAcA,IAAI,CAACsE,IAAnB,IAA2B,KAAK7F,qBAAL,EAA/B,EAA6D;AACzD,gBAAI8F,QAAQ,GAAGvE,IAAI,CAACuE,QAApB;AACA,gBAAIC,SAAS,GAAG,KAAKjE,UAArB;;AACA,gBAAI,OAAO,SAASgE,QAAT,IAAqB,KAAK,CAAL,KAAWA,QAAhC,GAA2C,KAAK,CAAhD,GAAoDA,QAAQ,CAACE,OAAT,CAAiB7H,yBAAjB,CAA3D,CAAJ,EAA6G;AACzG,kBAAI4H,SAAJ,EAAe;AACX,oBAAIE,eAAe,GAAGH,QAAQ,CAACI,KAAT,CAAe/H,yBAAyB,CAACgI,MAA1B,GAAmC,CAAlD,CAAtB;;AACA,oBAAIF,eAAJ,EAAqB;AACjBF,kBAAAA,SAAS,CAAC3F,MAAV,CAAiB6F,eAAjB,EAAkC1E,IAAI,CAAC6E,KAAvC;AACH,iBAFD,MAEO;AACHL,kBAAAA,SAAS,CAAC3F,MAAV,CAAiBmB,IAAI,CAAC6E,KAAtB;AACH;AACJ;;AACD7E,cAAAA,IAAI,CAAC8E,OAAL,GAAe,IAAf;AACH,aAVD,MAUO,IAAI,SAASN,SAAT,IAAsB,KAAK,CAAL,KAAWA,SAAjC,IAA8CA,SAAS,CAAC3F,MAAV,CAAiB,SAAjB,CAA9C,IAA6E,MAAM0F,QAAQ,CAACE,OAAT,CAAiB,cAAjB,CAAvF,EAAyH;AAC5H,mBAAKtE,iBAAL;;AACAH,cAAAA,IAAI,CAAC8E,OAAL,GAAe,IAAf;AACH;AACJ;;AACD,eAAKxG,QAAL,CAAcC,KAAd,CAAoB,IAApB,EAA0BC,SAA1B;AACH,SAhKI;AAiKLuG,QAAAA,sBAAsB,EAAE,UAASC,iBAAT,EAA4B5H,IAA5B,EAAkC6H,IAAlC,EAAwCnB,SAAxC,EAAmDoB,UAAnD,EAA+D;AACnF,cAAIC,IAAI,GAAG,IAAX;AACA,cAAIC,UAAU,GAAG1J,CAAC,CAACoI,SAAD,CAAlB;AACA,cAAIxG,MAAM,GAAGF,IAAI,CAACE,MAAlB;AACA,cAAIE,UAAU,GAAGL,aAAa,CAACC,IAAD,CAA9B;AACA,cAAIiI,OAAO,GAAG,SAASL,iBAAT,IAA8B,KAAK,CAAL,KAAWA,iBAAzC,GAA6D,KAAK,CAAlE,GAAsEA,iBAAiB,CAACjE,GAAlB,CAAsBuE,IAA1G;AACA,cAAIC,WAAW,GAAGtJ,MAAM,CAAC,EAAD,EAAK+I,iBAAL,EAAwB;AAC5CM,YAAAA,IAAI,EAAED,OADsC;AAE5CG,YAAAA,WAAW,EAAE,IAF+B;AAG5CC,YAAAA,QAAQ,EAAE,IAHkC;AAI5CrI,YAAAA,IAAI,EAAEA,IAJsC;AAK5CE,YAAAA,MAAM,EAAErB,MAAM,CAAC,EAAD,EAAKqB,MAAL,EAAa;AACvBE,cAAAA,UAAU,EAAEA,UADW;AAEvBkI,cAAAA,aAAa,EAAEtI,IAAI,CAACsI;AAFG,aAAb,CAL8B;AAS5CC,YAAAA,EAAE,EAAEV,IAAI,CAACW,SAAL,CAAexI,IAAI,CAACkH,IAAL,IAAalH,IAAI,CAACyI,SAAjC,CATwC;AAU5CC,YAAAA,WAAW,EAAExI,MAAM,CAACyI,KAVwB;AAW5CC,YAAAA,QAAQ,EAAE,CAACd,UAAD,IAAe5H,MAAM,CAAC2I,YAAtB,IAAsC,UAASpB,KAAT,EAAgB;AAC5DM,cAAAA,IAAI,CAACe,gBAAL,CAAsBX,WAAtB,EAAmCV,KAAnC;AACH;AAb2C,WAAxB,CAAxB;AAeAU,UAAAA,WAAW,CAACV,KAAZ,GAAoBvH,MAAM,CAAC6I,kBAAP,CAA0Bd,OAA1B,CAApB;;AACA,cAAIe,QAAQ,GAAG,KAAKC,wBAAL,CAA8BC,IAA9B,CAAmC,IAAnC,EAAyCf,WAAzC,EAAsDjI,MAAtD,CAAf;;AACA,eAAKgC,SAAL,CAAeiH,cAAf,CAA8BnB,UAA9B,EAA0CgB,QAA1C,EAAoDb,WAApD,EAAiE,CAAC,CAACH,UAAU,CAACoB,OAAX,CAAmB7K,SAAS,GAAG8K,QAA/B,EAAyC7B,MAA5G,EAAoHvD,IAApH,CAAyH,MAAM;AAC3H,iBAAK/B,SAAL,CAAeoH,WAAf,CAA2BtB,UAA3B,EAAuCG,WAAvC;AACH,WAFD;;AAGA,iBAAOA,WAAP;AACH,SA5LI;AA6LLoB,QAAAA,qBAAqB,EAAE,UAASpB,WAAT,EAAsBnI,IAAtB,EAA4B;AAC/C,cAAIE,MAAM,GAAG,KAAKqF,SAAL,CAAeiE,YAAf,CAA4BxJ,IAAI,CAACyI,SAAjC,CAAb;AACA,iBAAO,CAACzD,OAAD,EAAU0B,SAAV,KAAwB;AAC3B,gBAAI+C,qBAAJ,EAA2BC,gBAA3B;;AACA,gBAAI1B,UAAU,GAAG1J,CAAC,CAACoI,SAAD,CAAlB;AACA,sBAAU+C,qBAAqB,GAAG,CAACC,gBAAgB,GAAGvB,WAAW,CAACxE,GAAhC,EAAqCgG,KAAvE,KAAiF,KAAK,CAAL,KAAWF,qBAA5F,GAAoH,KAAK,CAAzH,GAA6HA,qBAAqB,CAACzF,IAAtB,CAA2B0F,gBAA3B,EAA8C,YAAW;AAClL,qBAAOxJ,MAAM,CAAC0J,QAAP,CAAgBzB,WAAW,CAACxE,GAAZ,CAAgBuE,IAAhC,CAAP;AACH,aAF4H,EAEzH,MAAM;AACN,kBAAI2B,UAAJ;;AACA,kBAAIC,cAAc,GAAG9B,UAAU,CAAC/B,IAAX,CAAgB,YAAhB,EAA8BE,KAA9B,EAArB;AACA,kBAAI4D,SAAS,GAAGD,cAAc,CAAC5B,IAAf,CAAoB,aAApB,CAAhB;AACA,kBAAI8B,gBAAgB,GAAG,UAAUH,UAAU,GAAGE,SAAvB,KAAqC,KAAK,CAAL,KAAWF,UAAhD,GAA6D,KAAK,CAAlE,GAAsEA,UAAU,CAACpI,MAAX,EAA7F;AACAuG,cAAAA,UAAU,CAACiC,QAAX,GAAsBC,MAAtB;AACA/B,cAAAA,WAAW,GAAG,KAAKR,sBAAL,CAA4BuB,IAA5B,CAAiC,IAAjC,EAAuCf,WAAvC,EAAoDnI,IAApD,EAA0DgF,OAAO,CAACO,SAAlE,EAA6EyC,UAA7E,CAAd;AACA8B,cAAAA,cAAc,GAAG9B,UAAU,CAAC/B,IAAX,CAAgB,YAAhB,EAA8BE,KAA9B,EAAjB;AACA4D,cAAAA,SAAS,GAAGD,cAAc,CAAC5B,IAAf,CAAoB,aAApB,CAAZ;;AACA,kBAAI8B,gBAAgB,IAAI,CAACD,SAAzB,EAAoC;AAChCD,gBAAAA,cAAc,CAACK,WAAf,CAA2B;AACvBC,kBAAAA,eAAe,EAAEJ,gBAAgB,CAACI,eADX;AAEvBC,kBAAAA,eAAe,EAAEL,gBAAgB,CAACK,eAFX;AAGvBC,kBAAAA,UAAU,EAAEN,gBAAgB,CAACM;AAHN,iBAA3B;AAKH;AACJ,aAlB4H,CAA7H;AAmBAnC,YAAAA,WAAW,GAAG,KAAKR,sBAAL,CAA4BuB,IAA5B,CAAiC,IAAjC,EAAuCf,WAAvC,EAAoDnI,IAApD,EAA0DgF,OAAO,CAACO,SAAlE,EAA6EyC,UAA7E,CAAd;AACH,WAvBD;AAwBH,SAvNI;AAwNLuC,QAAAA,kBAAkB,EAAE,UAASC,aAAT,EAAwB;AACxC,cAAIC,qBAAJ;;AACA,cAAIC,eAAe,GAAG,UAAUD,qBAAqB,GAAG,KAAKE,0BAAvC,KAAsE,KAAK,CAAL,KAAWF,qBAAjF,GAAyG,KAAK,CAA9G,GAAkHA,qBAAqB,CAACzG,IAAtB,CAA2B,IAA3B,EAAiCwG,aAAjC,CAAxI;AACA,cAAII,iBAAiB,GAAG,KAAKnJ,MAAL,CAAY,4BAAZ,CAAxB;AACA,cAAIoJ,iBAAiB,GAAG,KAAKnF,eAAL,CAAqBhG,oBAArB,CAAxB;AACA,cAAIa,KAAK,GAAG,KAAKkB,MAAL,CAAY,oBAAZ,CAAZ;AACA,cAAItB,kBAAkB,GAAG,EAAzB;;AACA,cAAI,CAACI,KAAL,EAAY;AACR,gBAAIuK,OAAO,GAAG,KAAKC,aAAL,CAAmB,SAAnB,EAA8BC,UAA9B,EAAd;AACAzK,YAAAA,KAAK,GAAG,EAAR;AACA3B,YAAAA,IAAI,CAACkM,OAAD,EAAW,UAASG,CAAT,EAAY/K,MAAZ,EAAoB;AAC/B,kBAAI,CAACA,MAAM,CAACgL,MAAR,IAAkB,CAAChL,MAAM,CAACiL,IAA9B,EAAoC;AAChC5K,gBAAAA,KAAK,CAAC6K,IAAN,CAAW;AACPlL,kBAAAA,MAAM,EAAEA,MADD;AAEPgH,kBAAAA,IAAI,EAAEhH,MAAM,CAACgH,IAFN;AAGPuB,kBAAAA,SAAS,EAAEvI,MAAM,CAACuI;AAHX,iBAAX;AAKH;AACJ,aARG,CAAJ;AASH,WAZD,MAYO;AACHnI,YAAAA,gBAAgB,CAACC,KAAD,EAAQP,IAAI,IAAI;AAC5B,kBAAIqL,MAAM,GAAG,CAAC,SAASrL,IAAT,IAAiB,KAAK,CAAL,KAAWA,IAA5B,GAAmC,KAAK,CAAxC,GAA4CA,IAAI,CAACkH,IAAlD,MAA4D,SAASlH,IAAT,IAAiB,KAAK,CAAL,KAAWA,IAA5B,GAAmC,KAAK,CAAxC,GAA4CA,IAAI,CAACyI,SAA7G,CAAb;;AACA,kBAAI4C,MAAJ,EAAY;AACRlL,gBAAAA,kBAAkB,CAACkL,MAAD,CAAlB,GAA6B,CAAC,CAACrL,IAAI,CAACI,UAApC;AACH;AACJ,aALe,CAAhB;AAMH;;AACD,iBAAOvB,MAAM,CAAC,EAAD,EAAK6L,eAAL,EAAsB;AAC/BnK,YAAAA,KAAK,EAAEA,KADwB;AAE/B+K,YAAAA,MAAM,EAAE,QAAQ,IAAI7M,IAAJ,EAFe;AAG/B8M,YAAAA,aAAa,EAAEvL,IAAI,IAAI;AACnB,kBAAIE,MAAJ;AACA,kBAAImL,MAAM,GAAGrL,IAAI,CAACkH,IAAL,IAAalH,IAAI,CAACyI,SAA/B;;AACA,kBAAIzI,IAAI,CAACE,MAAL,IAAemL,MAAnB,EAA2B;AACvBnL,gBAAAA,MAAM,GAAGF,IAAI,CAACE,MAAL,IAAe,KAAKsL,kBAAL,CAAwBhC,YAAxB,CAAqCxJ,IAAI,CAACkH,IAAL,GAAY,UAAUlH,IAAI,CAACkH,IAA3B,GAAkC,eAAelH,IAAI,CAACyI,SAA3F,CAAxB;AACH;;AACD,kBAAIvI,MAAJ,EAAY;AACRF,gBAAAA,IAAI,CAACyL,KAAL,GAAazL,IAAI,CAACyL,KAAL,IAAc,EAA3B;AACAzL,gBAAAA,IAAI,CAACyL,KAAL,CAAWC,IAAX,GAAkB1L,IAAI,CAACyL,KAAL,CAAWC,IAAX,IAAmBxL,MAAM,CAACyL,OAA5C;AACA3L,gBAAAA,IAAI,CAACgJ,QAAL,GAAgBhJ,IAAI,CAACgJ,QAAL,IAAiB,KAAKO,qBAAL,CAA2BiB,aAA3B,EAA0CxK,IAA1C,CAAjC;AACAA,gBAAAA,IAAI,CAACE,MAAL,GAAcA,MAAd;AACAF,gBAAAA,IAAI,CAACG,kBAAL,GAA0BA,kBAAkB,CAACkL,MAAD,CAA5C;;AACA,oBAAInL,MAAM,CAACG,QAAX,EAAqB;AACjBxB,kBAAAA,MAAM,CAACmB,IAAD,EAAOE,MAAM,CAACG,QAAd,CAAN;AACH;;AACD,oBAAI,KAAK,CAAL,KAAWL,IAAI,CAAC4L,UAAhB,IAA8B1L,MAAM,CAACkK,eAAzC,EAA0D;AACtDpK,kBAAAA,IAAI,CAAC4L,UAAL,GAAkB1L,MAAM,CAACkK,eAAP,CAAuByB,IAAvB,CAA6B,UAASC,IAAT,EAAe;AAC1D,2BAAO,eAAeA,IAAI,CAACX,IAA3B;AACH,mBAFiB,CAAlB;AAGAnL,kBAAAA,IAAI,CAACoK,eAAL,GAAuB,EAAvB;AACH;;AACD,oBAAI2B,WAAW,GAAGrN,SAAS,CAACsB,IAAI,CAACgM,OAAN,CAAT,GAA0BhM,IAAI,CAACgM,OAA/B,GAAyC,IAA3D;;AACA,oBAAI,CAAC,KAAKpK,cAAN,IAAwBmK,WAA5B,EAAyC;AACrC,uBAAKnK,cAAL,GAAsB5B,IAAtB;AACH;AACJ;;AACD,uBAAS4K,iBAAT,IAA8B,KAAK,CAAL,KAAWA,iBAAzC,GAA6D,KAAK,CAAlE,GAAsEA,iBAAiB,CAAC5G,IAAlB,CAAuB,IAAvB,EAA6BhE,IAA7B,CAAtE;AACAA,cAAAA,IAAI,CAACiM,QAAL,GAAgBtN,QAAQ,CAACqB,IAAI,CAACiM,QAAN,CAAR,GAA0BjM,IAAI,CAACiM,QAAL,GAAgB,GAAhB,GAAsBpB,iBAAhD,GAAoEA,iBAApF;AACH;AA/B8B,WAAtB,CAAb;AAiCH,SApRI;AAqRLjE,QAAAA,mBAAmB,EAAE,YAAW;AAC5B,iBAAO,CAACoB,UAAD,EAAawC,aAAb,EAA4B0B,cAA5B,KAA+C;AAClD,gBAAIxB,eAAe,GAAG,KAAKjJ,MAAL,CAAY,cAAZ,CAAtB;AACA,gBAAI0K,mBAAmB,GAAG,KAAK5B,kBAAL,CAAwBC,aAAxB,CAA1B;AACA,iBAAK5I,cAAL,GAAsB,KAAK,CAA3B;AACA,iBAAKZ,SAAL,GAAiB,KAAK2E,gBAAL,CAAsBrH,CAAC,CAAC,OAAD,CAAD,CAAWgH,QAAX,CAAoB0C,UAApB,CAAtB,EAAuDhJ,IAAvD,EAA6DH,MAAM,CAAC,EAAD,EAAK6L,eAAL,EAAsByB,mBAAtB,CAAnE,CAAjB;;AACA,gBAAI,CAACD,cAAL,EAAqB;AACjB,kBAAIE,iBAAiB,GAAG9N,CAAC,CAAC,OAAD,CAAD,CAAWmH,QAAX,CAAoB,KAAKC,eAAL,CAAqB5F,4BAArB,CAApB,EAAwEwF,QAAxE,CAAiF0C,UAAjF,CAAxB;;AACA,mBAAKrC,gBAAL,CAAsBrH,CAAC,CAAC,OAAD,CAAD,CAAWgH,QAAX,CAAoB8G,iBAApB,CAAtB,EAA8DtN,MAA9D,EAAsE,KAAKmG,oBAAL,EAAtE;;AACA,mBAAKU,gBAAL,CAAsBrH,CAAC,CAAC,OAAD,CAAD,CAAWgH,QAAX,CAAoB8G,iBAApB,CAAtB,EAA8DtN,MAA9D,EAAsE,KAAKoG,sBAAL,EAAtE;AACH;;AACD,iBAAKlE,SAAL,CAAe4E,EAAf,CAAkB,cAAlB,EAAkC,MAAM;AACpC,kBAAIyG,iBAAJ;;AACA,wBAAUA,iBAAiB,GAAG,KAAKlJ,UAAnC,KAAkD,KAAK,CAAL,KAAWkJ,iBAA7D,GAAiF,KAAK,CAAtF,GAA0FA,iBAAiB,CAACnI,OAAlB,EAA1F;AACH,aAHD;AAIH,WAdD;AAeH,SArSI;AAsSLoI,QAAAA,WAAW,EAAE,YAAW;AACpB,iBAAO,KAAKtL,SAAZ;AACH,SAxSI;AAySLuL,QAAAA,cAAc,EAAE,YAAW;AACvB,cAAIC,qBAAJ;;AACA,oBAAUA,qBAAqB,GAAG,KAAKvL,uBAAvC,KAAmE,KAAK,CAAL,KAAWuL,qBAA9E,GAAsG,KAAK,CAA3G,GAA+GA,qBAAqB,CAACpI,OAAtB,EAA/G;AACH,SA5SI;AA6SLqI,QAAAA,gBAAgB,EAAE,YAAW;AACzB,eAAKvL,QAAL,CAAcC,KAAd,CAAoB,IAApB,EAA0BC,SAA1B;;AACA,cAAI,KAAKE,eAAL,EAAJ,EAA4B;AACxB,gBAAIoL,iBAAJ;;AACA,sBAAUA,iBAAiB,GAAG,KAAKvJ,UAAnC,KAAkD,KAAK,CAAL,KAAWuJ,iBAA7D,GAAiF,KAAK,CAAtF,GAA0FA,iBAAiB,CAACC,IAAlB,EAA1F;AACH;AACJ,SAnTI;AAoTLC,QAAAA,oBAAoB,EAAE,UAAS5M,IAAT,EAAe6M,IAAf,EAAqB;AACvC,cAAI;AACA1B,YAAAA,IAAI,EAAEA;AADN,cAEA0B,IAFJ;;AAGA,cAAI,KAAKvL,eAAL,MAA0B6J,IAAI,KAAK1L,0BAAvC,EAAmE;AAC/DO,YAAAA,IAAI,CAACgM,OAAL,GAAe,KAAf;AACH;;AACD,eAAK9K,QAAL,CAAcC,KAAd,CAAoB,IAApB,EAA0BC,SAA1B;AACH,SA5TI;AA6TL0L,QAAAA,6BAA6B,EAAE,UAASC,UAAT,EAAqBzJ,QAArB,EAA+B0J,WAA/B,EAA4C;AACvE,cAAI,KAAK1L,eAAL,EAAJ,EAA4B;AACxB,iBAAKiC,cAAL,CAAoBD,QAApB;AACH,WAFD,MAEO;AACH,iBAAKpC,QAAL,CAAcC,KAAd,CAAoB,IAApB,EAA0BC,SAA1B;AACH;AACJ;AAnUI,OADA;AAsUT8G,MAAAA,IAAI,EAAE;AACF+E,QAAAA,eAAe,EAAE,UAASjN,IAAT,EAAe;AAC5B,cAAI,KAAKkN,kBAAL,CAAwB3L,cAAxB,EAAJ,EAA8C;AAC1CvB,YAAAA,IAAI,CAACwG,OAAL,GAAe,QAAf;AACH;AACJ;AALC;AAtUG,KADN;AA+UP2G,IAAAA,KAAK,EAAE;AACHC,MAAAA,QAAQ,EAAE;AACNC,QAAAA,kBAAkB,EAAE,UAASC,KAAT,EAAgBtI,OAAhB,EAAyB;AACzC,cAAI,WAAWA,OAAO,CAACwB,OAAnB,IAA8B,KAAK0G,kBAAL,CAAwB5L,eAAxB,EAA9B,IAA2E,UAAU0D,OAAO,CAACrB,GAAR,CAAYqI,OAArG,EAA8G;AAC1G;AACH;;AACD,eAAK9K,QAAL,CAAcC,KAAd,CAAoB,IAApB,EAA0BC,SAA1B;AACH,SANK;AAONe,QAAAA,eAAe,EAAE,UAASmB,QAAT,EAAmB;AAChC,cAAIiK,aAAa,GAAG,KAAKrM,QAAL,CAAcoC,QAAd,CAApB;AACA,cAAIkK,iBAAiB,GAAG,KAAKN,kBAA7B;AACA,cAAIrK,QAAQ,GAAG2K,iBAAiB,CAAClB,WAAlB,EAAf;AACA,cAAImB,gBAAgB,GAAGD,iBAAiB,CAACnL,mBAAlB,EAAvB;;AACA,cAAIoL,gBAAgB,KAAKnK,QAArB,IAAiCiK,aAAjC,IAAkD1K,QAAtD,EAAgE;AAC5D,mBAAOA,QAAQ,CAAC2C,QAAT,GAAoBS,IAApB,CAAyB,MAAM,KAAKP,eAAL,CAAqBhG,oBAArB,CAAN,GAAmD,KAAnD,GAA2DG,YAApF,CAAP;AACH;;AACD,iBAAO0N,aAAP;AACH,SAhBK;AAiBNG,QAAAA,sBAAsB,EAAE,UAASC,MAAT,EAAiBrK,QAAjB,EAA2BsK,gBAA3B,EAA6C;AACjE,cAAIH,gBAAgB,GAAG,KAAKP,kBAAL,CAAwB7K,mBAAxB,EAAvB;;AACA,cAAIoL,gBAAgB,KAAKnK,QAArB,IAAiC3E,QAAQ,CAACiP,gBAAD,CAA7C,EAAiE;AAC7D,gBAAI1N,MAAM,GAAG,KAAKsL,kBAAL,CAAwBhC,YAAxB,CAAqCoE,gBAArC,CAAb;;AACA,mBAAO,KAAKxL,8BAAL,CAAoCuL,MAApC,EAA4CzN,MAA5C,CAAP;AACH;;AACD,iBAAO,KAAKgB,QAAL,CAAcC,KAAd,CAAoB,IAApB,EAA0BC,SAA1B,CAAP;AACH,SAxBK;AAyBNgB,QAAAA,8BAA8B,EAAE,UAASuL,MAAT,EAAiBzN,MAAjB,EAAyB;AACrD,cAAI2N,YAAY,GAAG,CAAC,CAApB;AACAjP,UAAAA,IAAI,CAAC+O,MAAD,EAAU,UAAShF,KAAT,EAAgBP,WAAhB,EAA6B;AACvC,gBAAIpI,IAAI,GAAG1B,CAAC,CAAC8J,WAAD,CAAD,CAAenC,IAAf,CAAoB,wBAApB,EAA8CiC,IAA9C,CAAmD,cAAnD,CAAX;;AACA,gBAAI,SAASlI,IAAT,IAAiB,KAAK,CAAL,KAAWA,IAA5B,IAAoCA,IAAI,CAACE,MAAzC,IAAmDA,MAAnD,IAA6DF,IAAI,CAACE,MAAL,CAAYyI,KAAZ,KAAsBzI,MAAM,CAACyI,KAA9F,EAAqG;AACjGkF,cAAAA,YAAY,GAAGlF,KAAf;AACA,qBAAO,KAAP;AACH;AACJ,WANG,CAAJ;AAOA,iBAAOkF,YAAP;AACH,SAnCK;AAoCNC,QAAAA,WAAW,EAAE,UAASC,UAAT,EAAqB;AAC9B,cAAIC,WAAW,GAAG,aAAaD,UAAU,CAACvH,OAAxB,IAAmC,qBAAqBuH,UAAU,CAACvH,OAArF;;AACA,cAAIyH,cAAc,GAAG,WAAWF,UAAU,CAACvH,OAAtB,IAAiC,KAAK0G,kBAAL,CAAwB5L,eAAxB,EAAtD;;AACA,iBAAO,CAAC0M,WAAW,IAAIC,cAAhB,KAAmCF,UAAU,CAAC/N,IAArD;AACH,SAxCK;AAyCNsJ,QAAAA,WAAW,EAAE,UAASgE,KAAT,EAAgBS,UAAhB,EAA4B;AACrC,cAAI,KAAKD,WAAL,CAAiBC,UAAjB,CAAJ,EAAkC;AAC9B,iBAAKG,iBAAL,CAAuBH,UAAvB,EAAmCT,KAAnC;AACH,WAFD,MAEO;AACH,iBAAKpM,QAAL,CAAcoM,KAAd,EAAqBS,UAArB;AACH;AACJ;AA/CK;AADP;AA/UA;AADqB,CAA7B","sourcesContent":["/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.editing_form_based.js)\r\n * Version: 21.1.5\r\n * Build date: Mon Aug 02 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../core/renderer\";\r\nimport {\r\n    getWindow\r\n} from \"../../core/utils/window\";\r\nimport eventsEngine from \"../../events/core/events_engine\";\r\nimport Guid from \"../../core/guid\";\r\nimport {\r\n    isDefined,\r\n    isString\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    each\r\n} from \"../../core/utils/iterator\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport Button from \"../button\";\r\nimport devices from \"../../core/devices\";\r\nimport Form from \"../form\";\r\nimport {\r\n    Deferred\r\n} from \"../../core/utils/deferred\";\r\nimport Scrollable from \"../scroll_view/ui.scrollable\";\r\nimport Popup from \"../popup\";\r\nimport {\r\n    EDIT_MODE_FORM,\r\n    EDIT_MODE_POPUP,\r\n    FOCUSABLE_ELEMENT_SELECTOR,\r\n    EDITING_EDITROWKEY_OPTION_NAME,\r\n    EDITING_POPUP_OPTION_NAME,\r\n    DATA_EDIT_DATA_INSERT_TYPE\r\n} from \"./ui.grid_core.editing_constants\";\r\nvar EDIT_FORM_ITEM_CLASS = \"edit-form-item\";\r\nvar EDIT_POPUP_CLASS = \"edit-popup\";\r\nvar SCROLLABLE_CONTAINER_CLASS = \"dx-scrollable-container\";\r\nvar BUTTON_CLASS = \"dx-button\";\r\nvar FORM_BUTTONS_CONTAINER_CLASS = \"form-buttons-container\";\r\nvar getEditorType = item => {\r\n    var _column$formItem;\r\n    var column = item.column;\r\n    return item.isCustomEditorType ? item.editorType : null === (_column$formItem = column.formItem) || void 0 === _column$formItem ? void 0 : _column$formItem.editorType\r\n};\r\nvar forEachFormItems = (items, callBack) => {\r\n    items.forEach(item => {\r\n        if (item.items || item.tabs) {\r\n            forEachFormItems(item.items || item.tabs, callBack)\r\n        } else {\r\n            callBack(item)\r\n        }\r\n    })\r\n};\r\nexport var editingFormBasedModule = {\r\n    extenders: {\r\n        controllers: {\r\n            editing: {\r\n                init: function() {\r\n                    this._editForm = null;\r\n                    this._updateEditFormDeferred = null;\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                isFormOrPopupEditMode: function() {\r\n                    return this.isPopupEditMode() || this.isFormEditMode()\r\n                },\r\n                isPopupEditMode: function() {\r\n                    var editMode = this.option(\"editing.mode\");\r\n                    return editMode === EDIT_MODE_POPUP\r\n                },\r\n                isFormEditMode: function() {\r\n                    var editMode = this.option(\"editing.mode\");\r\n                    return editMode === EDIT_MODE_FORM\r\n                },\r\n                getFirstEditableColumnIndex: function() {\r\n                    var firstFormItem = this._firstFormItem;\r\n                    if (this.isFormEditMode() && firstFormItem) {\r\n                        var editRowKey = this.option(EDITING_EDITROWKEY_OPTION_NAME);\r\n                        var editRowIndex = this._dataController.getRowIndexByKey(editRowKey);\r\n                        var $editFormElements = this._rowsView.getCellElements(editRowIndex);\r\n                        return this._rowsView._getEditFormEditorVisibleIndex($editFormElements, firstFormItem.column)\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                getEditFormRowIndex: function() {\r\n                    return this.isFormOrPopupEditMode() ? this._getVisibleEditRowIndex() : this.callBase.apply(this, arguments)\r\n                },\r\n                _isEditColumnVisible: function() {\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    var editingOptions = this.option(\"editing\");\r\n                    return this.isFormOrPopupEditMode() ? editingOptions.allowUpdating || result : result\r\n                },\r\n                _handleDataChanged: function(args) {\r\n                    var editForm = this._editForm;\r\n                    if (\"refresh\" === args.changeType && this.isPopupEditMode() && null !== editForm && void 0 !== editForm && editForm.option(\"visible\")) {\r\n                        this._repaintEditPopup()\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                getPopupContent: function() {\r\n                    var _this$_editPopup;\r\n                    var popupVisible = null === (_this$_editPopup = this._editPopup) || void 0 === _this$_editPopup ? void 0 : _this$_editPopup.option(\"visible\");\r\n                    if (this.isPopupEditMode() && popupVisible) {\r\n                        return this._$popupContent\r\n                    }\r\n                },\r\n                _showAddedRow: function(rowIndex) {\r\n                    if (this.isPopupEditMode()) {\r\n                        this._showEditPopup(rowIndex)\r\n                    } else {\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                },\r\n                _cancelEditDataCore: function() {\r\n                    this.callBase.apply(this, arguments);\r\n                    if (this.isPopupEditMode()) {\r\n                        this._hideEditPopup()\r\n                    }\r\n                },\r\n                _updateEditRowCore: function(row, skipCurrentRow, isCustomSetCellValue) {\r\n                    var editForm = this._editForm;\r\n                    if (this.isPopupEditMode()) {\r\n                        if (this.option(\"repaintChangesOnly\")) {\r\n                            var _row$update;\r\n                            null === (_row$update = row.update) || void 0 === _row$update ? void 0 : _row$update.call(row, row)\r\n                        } else if (editForm) {\r\n                            this._updateEditFormDeferred = (new Deferred).done(() => editForm.repaint());\r\n                            if (!this._updateLockCount) {\r\n                                this._updateEditFormDeferred.resolve()\r\n                            }\r\n                        }\r\n                    } else {\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                },\r\n                _showEditPopup: function(rowIndex, repaintForm) {\r\n                    var isMobileDevice = \"desktop\" !== devices.current().deviceType;\r\n                    var popupOptions = extend({\r\n                        showTitle: false,\r\n                        fullScreen: isMobileDevice,\r\n                        toolbarItems: [{\r\n                            toolbar: \"bottom\",\r\n                            location: \"after\",\r\n                            widget: \"dxButton\",\r\n                            options: this._getSaveButtonConfig()\r\n                        }, {\r\n                            toolbar: \"bottom\",\r\n                            location: \"after\",\r\n                            widget: \"dxButton\",\r\n                            options: this._getCancelButtonConfig()\r\n                        }],\r\n                        contentTemplate: this._getPopupEditFormTemplate(rowIndex)\r\n                    }, this.option(EDITING_POPUP_OPTION_NAME));\r\n                    if (!this._editPopup) {\r\n                        var $popupContainer = $(\"<div>\").appendTo(this.component.$element()).addClass(this.addWidgetPrefix(EDIT_POPUP_CLASS));\r\n                        this._editPopup = this._createComponent($popupContainer, Popup, {});\r\n                        this._editPopup.on(\"hiding\", this._getEditPopupHiddenHandler());\r\n                        this._editPopup.on(\"shown\", e => {\r\n                            eventsEngine.trigger(e.component.$content().find(FOCUSABLE_ELEMENT_SELECTOR).not(\".\" + SCROLLABLE_CONTAINER_CLASS).first(), \"focus\");\r\n                            if (repaintForm) {\r\n                                var _this$_editForm;\r\n                                null === (_this$_editForm = this._editForm) || void 0 === _this$_editForm ? void 0 : _this$_editForm.repaint()\r\n                            }\r\n                        })\r\n                    }\r\n                    this._editPopup.option(popupOptions);\r\n                    this._editPopup.show();\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                _getPopupEditFormTemplate: function(rowIndex) {\r\n                    var row = this.component.getVisibleRows()[rowIndex];\r\n                    var templateOptions = {\r\n                        row: row,\r\n                        rowType: row.rowType,\r\n                        key: row.key\r\n                    };\r\n                    return container => {\r\n                        var formTemplate = this.getEditFormTemplate();\r\n                        var scrollable = this._createComponent($(\"<div>\").appendTo(container), Scrollable);\r\n                        this._$popupContent = scrollable.$content();\r\n                        formTemplate(this._$popupContent, templateOptions, true)\r\n                    }\r\n                },\r\n                _repaintEditPopup: function() {\r\n                    var _this$_editPopup2;\r\n                    var rowIndex = this._getVisibleEditRowIndex();\r\n                    if (null !== (_this$_editPopup2 = this._editPopup) && void 0 !== _this$_editPopup2 && _this$_editPopup2.option(\"visible\") && rowIndex >= 0) {\r\n                        var defaultAnimation = this._editPopup.option(\"animation\");\r\n                        this._editPopup.option(\"animation\", null);\r\n                        this._showEditPopup(rowIndex, true);\r\n                        this._editPopup.option(\"animation\", defaultAnimation)\r\n                    }\r\n                },\r\n                _hideEditPopup: function() {\r\n                    var _this$_editPopup3;\r\n                    null === (_this$_editPopup3 = this._editPopup) || void 0 === _this$_editPopup3 ? void 0 : _this$_editPopup3.option(\"visible\", false)\r\n                },\r\n                optionChanged: function(args) {\r\n                    if (\"editing\" === args.name && this.isFormOrPopupEditMode()) {\r\n                        var fullName = args.fullName;\r\n                        var editPopup = this._editPopup;\r\n                        if (0 === (null === fullName || void 0 === fullName ? void 0 : fullName.indexOf(EDITING_POPUP_OPTION_NAME))) {\r\n                            if (editPopup) {\r\n                                var popupOptionName = fullName.slice(EDITING_POPUP_OPTION_NAME.length + 1);\r\n                                if (popupOptionName) {\r\n                                    editPopup.option(popupOptionName, args.value)\r\n                                } else {\r\n                                    editPopup.option(args.value)\r\n                                }\r\n                            }\r\n                            args.handled = true\r\n                        } else if (null !== editPopup && void 0 !== editPopup && editPopup.option(\"visible\") && 0 === fullName.indexOf(\"editing.form\")) {\r\n                            this._repaintEditPopup();\r\n                            args.handled = true\r\n                        }\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                renderFormEditTemplate: function(detailCellOptions, item, form, container, isReadOnly) {\r\n                    var that = this;\r\n                    var $container = $(container);\r\n                    var column = item.column;\r\n                    var editorType = getEditorType(item);\r\n                    var rowData = null === detailCellOptions || void 0 === detailCellOptions ? void 0 : detailCellOptions.row.data;\r\n                    var cellOptions = extend({}, detailCellOptions, {\r\n                        data: rowData,\r\n                        cellElement: null,\r\n                        isOnForm: true,\r\n                        item: item,\r\n                        column: extend({}, column, {\r\n                            editorType: editorType,\r\n                            editorOptions: item.editorOptions\r\n                        }),\r\n                        id: form.getItemID(item.name || item.dataField),\r\n                        columnIndex: column.index,\r\n                        setValue: !isReadOnly && column.allowEditing && function(value) {\r\n                            that.updateFieldValue(cellOptions, value)\r\n                        }\r\n                    });\r\n                    cellOptions.value = column.calculateCellValue(rowData);\r\n                    var template = this._getFormEditItemTemplate.bind(this)(cellOptions, column);\r\n                    this._rowsView.renderTemplate($container, template, cellOptions, !!$container.closest(getWindow().document).length).done(() => {\r\n                        this._rowsView._updateCell($container, cellOptions)\r\n                    });\r\n                    return cellOptions\r\n                },\r\n                getFormEditorTemplate: function(cellOptions, item) {\r\n                    var column = this.component.columnOption(item.dataField);\r\n                    return (options, container) => {\r\n                        var _cellOptions$row$watc, _cellOptions$row;\r\n                        var $container = $(container);\r\n                        null === (_cellOptions$row$watc = (_cellOptions$row = cellOptions.row).watch) || void 0 === _cellOptions$row$watc ? void 0 : _cellOptions$row$watc.call(_cellOptions$row, (function() {\r\n                            return column.selector(cellOptions.row.data)\r\n                        }), () => {\r\n                            var _validator;\r\n                            var $editorElement = $container.find(\".dx-widget\").first();\r\n                            var validator = $editorElement.data(\"dxValidator\");\r\n                            var validatorOptions = null === (_validator = validator) || void 0 === _validator ? void 0 : _validator.option();\r\n                            $container.contents().remove();\r\n                            cellOptions = this.renderFormEditTemplate.bind(this)(cellOptions, item, options.component, $container);\r\n                            $editorElement = $container.find(\".dx-widget\").first();\r\n                            validator = $editorElement.data(\"dxValidator\");\r\n                            if (validatorOptions && !validator) {\r\n                                $editorElement.dxValidator({\r\n                                    validationRules: validatorOptions.validationRules,\r\n                                    validationGroup: validatorOptions.validationGroup,\r\n                                    dataGetter: validatorOptions.dataGetter\r\n                                })\r\n                            }\r\n                        });\r\n                        cellOptions = this.renderFormEditTemplate.bind(this)(cellOptions, item, options.component, $container)\r\n                    }\r\n                },\r\n                getEditFormOptions: function(detailOptions) {\r\n                    var _this$_getValidationG;\r\n                    var editFormOptions = null === (_this$_getValidationG = this._getValidationGroupsInForm) || void 0 === _this$_getValidationG ? void 0 : _this$_getValidationG.call(this, detailOptions);\r\n                    var userCustomizeItem = this.option(\"editing.form.customizeItem\");\r\n                    var editFormItemClass = this.addWidgetPrefix(EDIT_FORM_ITEM_CLASS);\r\n                    var items = this.option(\"editing.form.items\");\r\n                    var isCustomEditorType = {};\r\n                    if (!items) {\r\n                        var columns = this.getController(\"columns\").getColumns();\r\n                        items = [];\r\n                        each(columns, (function(_, column) {\r\n                            if (!column.isBand && !column.type) {\r\n                                items.push({\r\n                                    column: column,\r\n                                    name: column.name,\r\n                                    dataField: column.dataField\r\n                                })\r\n                            }\r\n                        }))\r\n                    } else {\r\n                        forEachFormItems(items, item => {\r\n                            var itemId = (null === item || void 0 === item ? void 0 : item.name) || (null === item || void 0 === item ? void 0 : item.dataField);\r\n                            if (itemId) {\r\n                                isCustomEditorType[itemId] = !!item.editorType\r\n                            }\r\n                        })\r\n                    }\r\n                    return extend({}, editFormOptions, {\r\n                        items: items,\r\n                        formID: \"dx-\" + new Guid,\r\n                        customizeItem: item => {\r\n                            var column;\r\n                            var itemId = item.name || item.dataField;\r\n                            if (item.column || itemId) {\r\n                                column = item.column || this._columnsController.columnOption(item.name ? \"name:\" + item.name : \"dataField:\" + item.dataField)\r\n                            }\r\n                            if (column) {\r\n                                item.label = item.label || {};\r\n                                item.label.text = item.label.text || column.caption;\r\n                                item.template = item.template || this.getFormEditorTemplate(detailOptions, item);\r\n                                item.column = column;\r\n                                item.isCustomEditorType = isCustomEditorType[itemId];\r\n                                if (column.formItem) {\r\n                                    extend(item, column.formItem)\r\n                                }\r\n                                if (void 0 === item.isRequired && column.validationRules) {\r\n                                    item.isRequired = column.validationRules.some((function(rule) {\r\n                                        return \"required\" === rule.type\r\n                                    }));\r\n                                    item.validationRules = []\r\n                                }\r\n                                var itemVisible = isDefined(item.visible) ? item.visible : true;\r\n                                if (!this._firstFormItem && itemVisible) {\r\n                                    this._firstFormItem = item\r\n                                }\r\n                            }\r\n                            null === userCustomizeItem || void 0 === userCustomizeItem ? void 0 : userCustomizeItem.call(this, item);\r\n                            item.cssClass = isString(item.cssClass) ? item.cssClass + \" \" + editFormItemClass : editFormItemClass\r\n                        }\r\n                    })\r\n                },\r\n                getEditFormTemplate: function() {\r\n                    return ($container, detailOptions, renderFormOnly) => {\r\n                        var editFormOptions = this.option(\"editing.form\");\r\n                        var baseEditFormOptions = this.getEditFormOptions(detailOptions);\r\n                        this._firstFormItem = void 0;\r\n                        this._editForm = this._createComponent($(\"<div>\").appendTo($container), Form, extend({}, editFormOptions, baseEditFormOptions));\r\n                        if (!renderFormOnly) {\r\n                            var $buttonsContainer = $(\"<div>\").addClass(this.addWidgetPrefix(FORM_BUTTONS_CONTAINER_CLASS)).appendTo($container);\r\n                            this._createComponent($(\"<div>\").appendTo($buttonsContainer), Button, this._getSaveButtonConfig());\r\n                            this._createComponent($(\"<div>\").appendTo($buttonsContainer), Button, this._getCancelButtonConfig())\r\n                        }\r\n                        this._editForm.on(\"contentReady\", () => {\r\n                            var _this$_editPopup4;\r\n                            null === (_this$_editPopup4 = this._editPopup) || void 0 === _this$_editPopup4 ? void 0 : _this$_editPopup4.repaint()\r\n                        })\r\n                    }\r\n                },\r\n                getEditForm: function() {\r\n                    return this._editForm\r\n                },\r\n                _endUpdateCore: function() {\r\n                    var _this$_updateEditForm;\r\n                    null === (_this$_updateEditForm = this._updateEditFormDeferred) || void 0 === _this$_updateEditForm ? void 0 : _this$_updateEditForm.resolve()\r\n                },\r\n                _beforeEndSaving: function() {\r\n                    this.callBase.apply(this, arguments);\r\n                    if (this.isPopupEditMode()) {\r\n                        var _this$_editPopup5;\r\n                        null === (_this$_editPopup5 = this._editPopup) || void 0 === _this$_editPopup5 ? void 0 : _this$_editPopup5.hide()\r\n                    }\r\n                },\r\n                _processDataItemCore: function(item, _ref) {\r\n                    var {\r\n                        type: type\r\n                    } = _ref;\r\n                    if (this.isPopupEditMode() && type === DATA_EDIT_DATA_INSERT_TYPE) {\r\n                        item.visible = false\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                _editRowFromOptionChangedCore: function(rowIndices, rowIndex, oldRowIndex) {\r\n                    if (this.isPopupEditMode()) {\r\n                        this._showEditPopup(rowIndex)\r\n                    } else {\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                }\r\n            },\r\n            data: {\r\n                _updateEditItem: function(item) {\r\n                    if (this._editingController.isFormEditMode()) {\r\n                        item.rowType = \"detail\"\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        views: {\r\n            rowsView: {\r\n                _renderCellContent: function($cell, options) {\r\n                    if (\"data\" === options.rowType && this._editingController.isPopupEditMode() && false === options.row.visible) {\r\n                        return\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                getCellElements: function(rowIndex) {\r\n                    var $cellElements = this.callBase(rowIndex);\r\n                    var editingController = this._editingController;\r\n                    var editForm = editingController.getEditForm();\r\n                    var editFormRowIndex = editingController.getEditFormRowIndex();\r\n                    if (editFormRowIndex === rowIndex && $cellElements && editForm) {\r\n                        return editForm.$element().find(\".\" + this.addWidgetPrefix(EDIT_FORM_ITEM_CLASS) + \", .\" + BUTTON_CLASS)\r\n                    }\r\n                    return $cellElements\r\n                },\r\n                _getVisibleColumnIndex: function($cells, rowIndex, columnIdentifier) {\r\n                    var editFormRowIndex = this._editingController.getEditFormRowIndex();\r\n                    if (editFormRowIndex === rowIndex && isString(columnIdentifier)) {\r\n                        var column = this._columnsController.columnOption(columnIdentifier);\r\n                        return this._getEditFormEditorVisibleIndex($cells, column)\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _getEditFormEditorVisibleIndex: function($cells, column) {\r\n                    var visibleIndex = -1;\r\n                    each($cells, (function(index, cellElement) {\r\n                        var item = $(cellElement).find(\".dx-field-item-content\").data(\"dx-form-item\");\r\n                        if (null !== item && void 0 !== item && item.column && column && item.column.index === column.index) {\r\n                            visibleIndex = index;\r\n                            return false\r\n                        }\r\n                    }));\r\n                    return visibleIndex\r\n                },\r\n                _isFormItem: function(parameters) {\r\n                    var isDetailRow = \"detail\" === parameters.rowType || \"detailAdaptive\" === parameters.rowType;\r\n                    var isPopupEditing = \"data\" === parameters.rowType && this._editingController.isPopupEditMode();\r\n                    return (isDetailRow || isPopupEditing) && parameters.item\r\n                },\r\n                _updateCell: function($cell, parameters) {\r\n                    if (this._isFormItem(parameters)) {\r\n                        this._formItemPrepared(parameters, $cell)\r\n                    } else {\r\n                        this.callBase($cell, parameters)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}